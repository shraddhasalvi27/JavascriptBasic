// Convert nested Callbacks to flat code using promises